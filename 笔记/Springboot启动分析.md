﻿﻿﻿# Springboot启动分析    下面是启动的主要代码		StopWatch stopWatch = new StopWatch();		//开启时间记载		stopWatch.start();		ConfigurableApplicationContext context = null;		Collection<SpringBootExceptionReporter> exceptionReporters = new ArrayList<>();		configureHeadlessProperty();		//获取spring.factorie中的SpringApplicationRunListener类添加到SpringApplicationRunListeners中		SpringApplicationRunListeners listeners = getRunListeners(args);		//遍历SpringApplicationRunListeners发布ApplicationStartingEvent事件		listeners.starting();		try {			ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);			//环境生成，并且发布ApplicationEnvironmentPreparedEvent事件，springcloud的bootstrap就是通过这个启动你bootstrap配置文件			ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments);			configureIgnoreBeanInfo(environment);						//打印控制台信息，可以通过spring.banner.location配置			Banner printedBanner = printBanner(environment);			//创建applicationcontext，这里创建的是AnnotationConfigServletWebServerApplicationContext类，该类会初始化AnnotatedBeanDefinitionReader和ClassPathBeanDefinitionScanner到context中，而AnnotatedBeanDefinitionReader会注册ConfigurationClassPostProcessor类到容器中，该类是解析@Configuration等。ClassPathBeanDefinitionScanner就是在解析时提供扫描功能。			context = createApplicationContext();			exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class,					new Class[] { ConfigurableApplicationContext.class }, context);						//添加环境变量到context中，spring.factories中配置的ApplicationContextInitializer执行initialize方法，可以看看spring.factories下的org.springframework.context.ApplicationContextInitializer。发布ApplicationContextInitializedEvent事件。			prepareContext(context, environment, listeners, applicationArguments, printedBanner);			//spring核心操作，刷新上下文			refreshContext(context);			afterRefresh(context, applicationArguments);			stopWatch.stop();			if (this.logStartupInfo) {				new StartupInfoLogger(this.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);			}			listeners.started(context);			callRunners(context, applicationArguments);		}		catch (Throwable ex) {			handleRunFailure(context, ex, exceptionReporters, listeners);			throw new IllegalStateException(ex);		}		try {			listeners.running(context);		}		catch (Throwable ex) {			handleRunFailure(context, ex, exceptionReporters, null);			throw new IllegalStateException(ex);		}		return context;